<!DOCTYPE html>
<html>
    <head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" href="style.css">
<title>How to program in Lua</title>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<!-- 導入 FileSaver 與 filereader -->
<script type="text/javascript" src="ace/FileSaver.min.js"></script>
<script type="text/javascript" src="ace/filereader.js"></script>
<script src="fengari-web.js"></script>
<script type="text/javascript">
function doSave(storage_id, filename){
    var blob = new Blob([localStorage[storage_id]], {type: "text/plain;charset=utf-8"});
    filename = document.getElementById(filename).value;
    //source_code = window.localStorage.getItem("lua_src_id");
    //document.getElementById("editor_field").value = source_code;
    saveAs(blob, filename+".lua");
}
</script>
</head>
    <body>
        <h1 class="center">Hello Lua!</h1>
        
        <div class="repl-container">
            <div class="row editor-container">
                <div id="editor_field" class="col-sm editor"></div>
                <div class="col-sm output"></div>
            </div>
            <div class="row">
                <button type="button" class="btn btn-primary btn-execute">Execute</button>
                &nbsp;&nbsp;
                <button onclick="window.clearCanvas()">清除畫面</button>
            </div>
    <form>
    <label>Filename: <input type="text" id="lua_filename" placeholder="input file name"/>.lua</label>
    <input type="submit" value="Save" onclick="doSave('lua_src_id', 'lua_filename');"/>
    </form>
      </div>
<script src="editor.lua" type="application/lua" async></script>
<!-- 以下的 lua 從 localStorage 取出原始碼, 放入 editor_field -->
<!-- 導入外部的 ext1.lua 程式內容 -->
<script type="application/lua">
package.path = "ext1.lua"
require("ex1")
js = require "js"
storage = js.global.localStorage
source_code = storage:getItem("lua_src_id")
if source_code ~= ""  then
    js.global.document:getElementById("editor_field").textContent = source_code
else
    js.global.document:getElementById("editor_field").textContent = fun1()
end
-- js.global:prompt("testing")
function js.global.clearCanvas()
    local canvas = js.global.document:getElementById("canvas")
    local ctx = canvas:getContext("2d")
    ctx:clearRect(0, 0, canvas.width, canvas.height)
end
</script>
<script src="ace/ace.js"></script>
<script src="ace/mode-lua.js"></script>
<script src="editor.js"></script>
<br /><br />
<canvas id="canvas" width="600" height="600"></canvas>
    </body>
</html>
